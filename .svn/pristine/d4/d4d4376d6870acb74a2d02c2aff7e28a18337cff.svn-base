package com.minwon.dao.impl;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpSession;

import org.apache.ibatis.session.SqlSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;

import com.minwon.dao.MainLoginDAO;
import com.minwon.vo.LoginVO;
import com.minwon.vo.MainLoginVO;
import com.minwon.vo.MemberVO;
import com.minwon.vo.UserVO;

@Repository
public class MainLoginDAOImpl implements MainLoginDAO {
	@Autowired
	SqlSession sqlSession;

	@Override
	public boolean loginCheck(MainLoginVO vo) {
		String name = sqlSession.selectOne("main.loginCheck", vo);
		return (name == null) ? false : true;
	}

	@Override
	public MainLoginVO viewMember(MainLoginVO vo) {
		return sqlSession.selectOne("main.viewMember", vo);
	}

	@Override
	public void logout(HttpSession session) {
	}

	@Override
	public int checkId(String id) throws Exception {
		return sqlSession.selectOne("main.checkId", id);
	}

	@Override
	public UserVO certificateLoginCheck(String dn) throws Exception {
		return sqlSession.selectOne("main.certificateLogincheck", dn);
	}

	@Override
	public String findId(String dn) throws Exception {
		String id = sqlSession.selectOne("main.findId", dn);
		if (id != null) {
			return "아이디는 " + id + "입니다.";
		} else {
			return "아이디를 찾을 수 없습니다.";
		}                                                                           
	}

	@Override
	public void memberRequest(MemberVO user2vo) throws Exception {
		sqlSession.insert("member.memberRequest", user2vo);
	}

	@Override
	public List<Map<String, Object>> getGroupedDistrict(int dpId, int uId) throws Exception {
		Map<String,Object> map = new HashMap<String,Object>();
		map.put("dpId", dpId);
		map.put("uId", uId);
		return sqlSession.selectList("main.getGroupedDistrict", map);
	}

	@Override
	public List<Map<String, Object>> getGroupedSeparationType(int dpId, int uId) throws Exception {
		Map<String,Object> map = new HashMap<String,Object>();
		map.put("dpId", dpId);
		map.put("uId", uId);
		return sqlSession.selectList("main.getGroupedSeparationType", map);
	}

	@Override
	public void changePassword(UserVO vo) throws Exception {
		sqlSession.update("main.changePassword", vo);
	}

	@Override
	public boolean isCertificagteRegistered(int id) throws Exception {
		String dn = sqlSession.selectOne("main.getDn", id);
		return (dn == null) ? false : true;
	}

	@Override
	public void registerCertificate(UserVO vo) throws Exception {
		sqlSession.update("main.registerCertificate", vo);
	}

	@Override
	public List<Map<String, Object>> getGroupedSeparationTypeSum(int dpId, int uId) {
		Map<String,Object> map = new HashMap<String,Object>();
		map.put("dpId", dpId);
		map.put("uId", uId);
		return sqlSession.selectList("main.getGroupedSeparationTypeSum", map);
	}

	@Override
	public List<Map<String, Object>> getGroupedDistrictSum(int dpId, int uId) throws Exception {
		Map<String,Object> map = new HashMap<String,Object>();
		map.put("dpId", dpId);
		map.put("uId", uId);
		return sqlSession.selectList("main.getGroupedDistrictSum", map);
	}

	@Override
	public List<Map<String, Object>> getGroupedDepartment(int dpId, int uId) throws Exception {
		Map<String,Object> map = new HashMap<String,Object>();
		map.put("dpId", dpId);
		map.put("uId", uId);
		return sqlSession.selectList("main.getGroupedDepartment", map);
	}

	@Override
	public List<Map<String, Object>> getGroupedDepartmentSum(int dpId, int uId) throws Exception {
		Map<String,Object> map = new HashMap<String,Object>();
		map.put("dpId", dpId);
		map.put("uId", uId);
		return sqlSession.selectList("main.getGroupedDepartmentSum", map);
	}
}
