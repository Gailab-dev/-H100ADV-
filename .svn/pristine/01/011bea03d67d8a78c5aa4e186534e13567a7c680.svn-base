package com.minwon.controller;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.servlet.ModelAndView;

import com.minwon.service.MainService;
import com.minwon.service.SearchService;
import com.minwon.vo.ComplaintVO;
import com.minwon.vo.SearchVO;


@Controller
@RequestMapping("/main/*")
public class SearchController {
	@Autowired
	MainService mainService;
	
	@Autowired
	SearchService searchService;
	
	@RequestMapping("mw_search_list.do")
	public ModelAndView mwSearchList(
			 HttpServletRequest request
			,@RequestParam(required=false,defaultValue="title")String searchType
            ,@RequestParam(required=false)String keyword
            ,@RequestParam(required=false)String startDate
            ,@RequestParam(required=false)String endDate
            ,@ModelAttribute("search")SearchVO searchVO) throws Exception {
		HttpSession session = request.getSession();
		ModelAndView mav = new ModelAndView();
		searchVO.setSearchType(searchType);
		searchVO.setKeyword(keyword);
		if ((int) session.getAttribute("userGrade") != 9) {
			searchVO.setDpId((int) session.getAttribute("userDpId"));
		} else {
			searchVO.setDpId(1);
		}
		searchVO.setStartDate(startDate);
		searchVO.setEndDate(endDate);
		int completeComplaintList = mainService.getCompletedListCnt(searchVO);
		int processComplaintList = mainService.getProcessListCnt(searchVO);
		List<ComplaintVO> list1 = searchService.getList1(searchVO);
		List<ComplaintVO> list2 = searchService.getList2(searchVO);
		List<ComplaintVO> list3 = searchService.getList3(searchVO);
		List<ComplaintVO> list4 = searchService.getList4(searchVO);
		List<ComplaintVO> list5 = searchService.getList5(searchVO);
		List<ComplaintVO> list6 = searchService.getList6(searchVO);
		List<ComplaintVO> list7 = searchService.getList7(searchVO);
		List<ComplaintVO> list8 = searchService.getList8(searchVO);
		List<ComplaintVO> list9 = searchService.getList9(searchVO);
		List<ComplaintVO> list10 = searchService.getList10(searchVO);
		List<ComplaintVO> list11 = searchService.getList11(searchVO);
		List<ComplaintVO> list12 = searchService.getList12(searchVO);
		List<String> minwonType = new ArrayList<String>(Arrays.asList("도로교통", "보행환경", "생활안전", "주차환경", "빈집관리", "하수정비", "청소환경", "공원관리", "체육시설", "보건복지", "문화경제", "기타"));
		List<List<ComplaintVO>> lists = new ArrayList<List<ComplaintVO>>(Arrays.asList(list1, list2, list3, list4, list5, list6, list7, list8, list9, list10, list11, list12));
		mav.setViewName("main/mw_search_list");
		mav.addObject("completeComplaintList", completeComplaintList);
		mav.addObject("processComplaintList", processComplaintList);
		mav.addObject("keyword", keyword);
		mav.addObject("minwonType", minwonType);
		mav.addObject("lists", lists);
		mav.addObject("searchType", searchType);
		mav.addObject("startDate", startDate);
		mav.addObject("endDate", endDate);
		return mav;
	}
}
