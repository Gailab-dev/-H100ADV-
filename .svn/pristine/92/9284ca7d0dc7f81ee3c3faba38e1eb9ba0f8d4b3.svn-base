package com.minwon.service.impl;

import java.io.IOException;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletResponse;

import org.apache.poi.hssf.util.HSSFColor;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.CellStyle;
import org.apache.poi.ss.usermodel.Font;
import org.apache.poi.ss.usermodel.IndexedColors;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.xssf.usermodel.XSSFCellStyle;
import org.apache.poi.xssf.usermodel.XSSFColor;
import org.apache.poi.xssf.usermodel.XSSFSheet;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.minwon.service.CryptoAriaService;
import com.minwon.service.ExcelService;
import com.minwon.vo.ComplaintVO;

@Service
public class ExcelServiceImpl implements ExcelService {
	@Autowired
	CryptoAriaService cryptoAriaService;

	@Override
	public void createExcel(HttpServletResponse response, List<ComplaintVO> complaintList) throws Exception {
		XSSFWorkbook workbook = new XSSFWorkbook();
		XSSFSheet sheet = workbook.createSheet("민원 리스트");
		for (int i = 0; i < 23; i++) {
			sheet.setColumnWidth(i, 7000);
		}
		
		int rowNo = 0;
		
		Font headerFont = workbook.createFont();
		headerFont.setFontHeight((short) 240);
		headerFont.setColor(IndexedColors.GREEN.getIndex());
		
		XSSFCellStyle headStyle = workbook.createCellStyle();
		headStyle.setBorderBottom(CellStyle.BORDER_THIN);
		headStyle.setFont(headerFont);
		headStyle.setWrapText(true);
		headStyle.setAlignment(XSSFCellStyle.ALIGN_CENTER);
		
		Font rowFont = workbook.createFont();
		rowFont.setFontHeight((short) 200);
		
		XSSFCellStyle rowStyle = workbook.createCellStyle();
		rowStyle.setWrapText(true);
		rowStyle.setFont(rowFont);
		rowStyle.setVerticalAlignment(XSSFCellStyle.VERTICAL_CENTER);
		String[] columns = {"신청접수일", "분류유형", "처리구분", "제목", "민원위치", "행정동", "민원인", "전화번호", "민원인주소", "민원접수경로", "처리완료(예정일)", "담당부서", "상위담당부서", "과장", "계장", "담당자", "민원내용", "처리계획", "만족도", "연관부서", "민원제기일", "민원제기횟수", "민원작성일"};
		
		Cell cell = null;
		Row headerRow = sheet.createRow(rowNo++);
		for (int i = 0; i < columns.length; i++) {
			cell = headerRow.createCell(i);
			cell.setCellValue(columns[i]);
			cell.setCellStyle(headStyle);
		}
		for (ComplaintVO complaint : complaintList) {
			Cell rowCell = null;
			Row row = sheet.createRow(rowNo++);
			rowCell = row.createCell(0);
			rowCell.setCellValue(complaint.getcReceiptDate());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(1);
			rowCell.setCellValue(complaint.getcSeparationType());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(2);
			rowCell.setCellValue(complaint.getcProcessClass());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(3);
			rowCell.setCellValue(complaint.getcTitle());
			rowCell.setCellStyle(rowStyle);
			/*rowCell = row.createCell(4);
			rowCell.setCellValue(complaint.getcKeyPoint());
			rowCell.setCellStyle(rowStyle);
			 * */
			rowCell = row.createCell(4);
			rowCell.setCellValue(complaint.getcAddress());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(5);
			rowCell.setCellValue(complaint.getcDistrict());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(6);
			rowCell.setCellValue(cryptoAriaService.decryptData(complaint.getcPetitioner()));
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(7);
			rowCell.setCellValue(cryptoAriaService.decryptData(complaint.getcPetitionerPhone()));
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(8);
			rowCell.setCellValue(cryptoAriaService.decryptData(complaint.getcPetitionerAddress()));
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(9);
			rowCell.setCellValue(complaint.getcReceiptWay());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(10);
			rowCell.setCellValue(complaint.getcDeadline());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(11);
			rowCell.setCellValue(complaint.getDpName());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(12);
			rowCell.setCellValue(complaint.getDpMasterName());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(13);
			rowCell.setCellValue(complaint.getcOfficer01());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(14);
			rowCell.setCellValue(complaint.getcOfficer02());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(15);
			rowCell.setCellValue(complaint.getcOfficer03());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(16);
			rowCell.setCellValue(complaint.getcContent());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(17);
			rowCell.setCellValue(complaint.getcPlan());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(18);
			rowCell.setCellValue(complaint.getcSatisfiction());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(19);
			rowCell.setCellValue(complaint.getDpName01() + "," + complaint.getDpName02() + "," + complaint.getDpName03() + "," + complaint.getDpName04());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(20);
			rowCell.setCellValue(complaint.getcRaiseDate());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(21);
			rowCell.setCellValue(complaint.getcRaiseCount());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(22);
			rowCell.setCellValue(complaint.getcWriteDate());
			rowCell.setCellStyle(rowStyle);
		}
		
		response.setContentType("ms-vnd/excel");
		response.setHeader("Content-Disposition", "attachment;filename=boardlist.xls");
		
		workbook.write(response.getOutputStream());
		workbook.close();
	}

	@Override
	public void createUserExcel(HttpServletResponse response, List<Map<String, Object>> userDeptList) throws Exception {
		XSSFWorkbook workbook = new XSSFWorkbook();
		XSSFSheet sheet = workbook.createSheet("사용자 부서 리스트");
		for (int i = 0; i < 6; i++) {
			sheet.setColumnWidth(i, 10000);
		}
		
		int rowNo = 0;
		
		Font headerFont = workbook.createFont();
		headerFont.setFontHeight((short) 300);
		headerFont.setColor(IndexedColors.GREEN.getIndex());
		
		XSSFCellStyle headStyle = workbook.createCellStyle();
		headStyle.setBorderBottom(CellStyle.BORDER_THIN);
		headStyle.setFont(headerFont);
		headStyle.setWrapText(true);
		headStyle.setAlignment(XSSFCellStyle.ALIGN_CENTER);
		
		XSSFCellStyle rowStyle = workbook.createCellStyle();
		rowStyle.setWrapText(true);
		rowStyle.setVerticalAlignment(XSSFCellStyle.VERTICAL_CENTER);
		String[] columns = {"부서3", "부서2", "부서1", "아이디", "성명", "이메일"};
		
		Cell cell = null;
		Row headerRow = sheet.createRow(rowNo++);
		for (int i = 0; i < columns.length; i++) {
			cell = headerRow.createCell(i);
			cell.setCellValue(columns[i]);
			cell.setCellStyle(headStyle);
		}
		for (Map<String, Object> userDept : userDeptList) {
			Cell rowCell = null;
			Row row = sheet.createRow(rowNo++);
			rowCell = row.createCell(0);
			if (userDept.get("d3name") == null) {
				rowCell.setCellValue("-");
			} else {
				rowCell.setCellValue(userDept.get("d3name").toString());
			}
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(1);
			if (userDept.get("d2name") == null) {
				rowCell.setCellValue("-");
			} else {
				rowCell.setCellValue(userDept.get("d2name").toString());
			}
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(2);
			if (userDept.get("d1name") == null) {
				rowCell.setCellValue("-");
			} else {
				rowCell.setCellValue(userDept.get("d1name").toString());
			}
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(3);
			rowCell.setCellValue(userDept.get("u_login_id").toString());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(4);
			rowCell.setCellValue(userDept.get("u_name").toString());
			rowCell.setCellStyle(rowStyle);
			rowCell = row.createCell(5);
			rowCell.setCellValue(userDept.get("u_email").toString());
			rowCell.setCellStyle(rowStyle);
		}
		
		response.setContentType("ms-vnd/excel");
		response.setHeader("Content-Disposition", "attachment;filename=userDept.xls");
		
		workbook.write(response.getOutputStream());
		workbook.close();
	}

}
